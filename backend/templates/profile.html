<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ user.nickname }} — Profile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/profile.css?v=6">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>

<body>

{% include "layout/navbar.html" %}

<div class="profile-wrapper">
  <div class="profile-grid">
    <!-- LEFT SIDEBAR -->
    <aside class="profile-side">

      {# рамки — оставляю как есть #}
      {% set equipped = user.frames | selectattr("equipped", "equalto", True) | list %}
      {% if equipped %}
        {% set frame_class = equipped[0].frame.name|lower %}
      {% else %}
        {% set frame_class = '' %}
      {% endif %}

      <div class="avatar-wrapper {{ frame_class }}">
        <img src="{{ user.avatar }}" class="avatar">

        {% if equipped and equipped[0].frame.image_url %}
          <img src="{{ equipped[0].frame.image_url }}" class="avatar-frame" alt="Frame">
        {% endif %}

        <!-- Кнопка-карандаш -->
        <a class="avatar-edit" href="/profile/customize" title="Customize avatar">
          <i class="fa-solid fa-pen"></i>
        </a>
      </div>

      <h2 class="nickname-with-badge">
          {{ user.nickname }}

          {% set equipped_badge = user.badges | selectattr("equipped", "equalto", True) | list %}
          {% if equipped_badge %}
              <img class="profile-badge" src="{{ equipped_badge[0].badge.icon_url }}" alt="Badge">
          {% endif %}
      </h2>


      <p class="coins">
        <i class="fa-solid fa-coins" style="color: gold;"></i>
        {{ user.coins }} coins
      </p>

      <p class="country">
        {{ user.country|flag }} {{ user.country }}
      </p>

      {# Ранг — оставил как было #}
      {% set level = user.level or 1 %}
      {% set xp = user.xp or 0 %}

      <div class="rank-box {% if level < 10 %}bronze{% 
elif level < 20 %}silver{% 
elif level < 30 %}gold{% 
elif level < 40 %}platinum{% 
else %}diamond{% endif %}">

        <p class="rank-title">Current Rank</p>

        <p class="rank-value">
          <i class="fa-solid fa-trophy"></i>
          {% if level < 10 %}
            Bronze Player
          {% elif level < 20 %}
            Silver Player
          {% elif level < 30 %}
            Gold Player
          {% elif level < 40 %}
            Platinum Player
          {% else %}
            Diamond Player
          {% endif %}
        </p>

        <div class="rank-progress">
          {% set progress = (xp / (100 * level)) * 100 %}
          <div class="rank-fill" style="width: {{ progress }}%"></div>
        </div>

        <small>XP: {{ xp }} / {{ 100 * level }} (Lvl {{ level }})</small>
      </div>

      <a href="/edit-profile" class="edit-btn full">
        <i class="fa-solid fa-pen"></i> Edit Profile
      </a>

      <a href="/account-security" class="edit-btn full" style="margin-top:10px;">
        <i class="fa-solid fa-shield-halved"></i> Account Security
      </a>

    </aside>

    <!-- MAIN CONTENT -->
    <section class="profile-main">

      <div class="profile-banner">
        <h1>{{ user.first_name }} {{ user.last_name }}</h1>
        <p><i class="fa-solid fa-cake-candles"></i> {{ user.dob }}</p>
      </div>

      <div class="profile-main-grid">
          <!-- LEFT COLUMN -->
          <div class="main-left">
              <div class="card">
                  <h3><i class="fa-solid fa-gamepad"></i> Favorite Game Genres</h3>
                  <div class="tags">
                      {% if user.category %}
                          {% for cat in user.category.split(',') %}
                            <span class="tag">{{ cat.title().replace('_',' ') }}</span>
                          {% endfor %}
                      {% else %}
                          <p>No selected categories</p>
                      {% endif %}
                  </div>
              </div>

              <div class="card achievements-card">
                  <h3><i class="fa-solid fa-medal"></i> Achievements</h3>
                  <p>No achievements yet — play tournaments to earn badges!</p>
              </div>

          </div>

          <!-- RIGHT COLUMN -->
          <div class="main-right">

              <div class="card badges-card">
                  <h3><i class="fa-solid fa-award"></i> Your Badges</h3>

                  <div class="badges-scroll">
                      {% for badge in user.badges %}
                          <img class="badge-icon" src="{{ badge.badge.icon_url }}" title="{{ badge.badge.name }}">
                      {% endfor %}
                  </div>
              </div>

          </div>

      </div>
    </section>


  </div>

</div>

{% include "layout/footer.html" %}
</body>
</html>